language: node_js

env:
  global:
    - CXX=g++-4.8
  matrix:
    # AWS_ACCESS_KEY and AWS_SECRET_KEY for dev.vets.gov
    - secure: "BQ0BNb3D2gI3hYHXgNIgDNBfZu/koPlZS1mjFqxYizQM+Msu+Zg/QDyeIXFpR7oMU9bmTCWpL2gBFYTOwHAqdP8uDQSz42jCRVGPOmWE9rDt6MDNkyG2M6afJ5FH+bvdcnfWT387iaGfc3jqVZHTVhvy2ay3DTCy8eoovJ7KOZIE+G9YtUxKzNjQHzJaCTloKrvJGIrbebONwJ54LD4GWw4jb7NuUONMpJPwC3ukF6t0gvT83aUf5anrhiu8ghNVYJSObeIXhyiIckley08naETfoK3B/POVf9ex/DbippFhyj64UweNLZ+KAVXUhPBI/CieOG9EdeZQXm7b53ZsdsmDsItXP+nE7+ihfWM4gmv3WJnbLTy12W1D2AF0uoMI5U/jcwRwfoHxVo6OpMbpF10fUVn/yDM/90rpiaB50ufZHtB5cMQfOFGr6/PCiZI/omAi3frUC4Zx6ZbiaG019JqmFHYmrkbTL6d1DTuXL3fawW71tR5a/o4GhOePlu/pXh7nQp4hiRZVo/ZtY6Sa5iuS5UaHmu4uzkXRMurNGrySmSyAFkVxIWG/nHQVTqU1ahgxyYrbtve/aUHZH/aUKr/719N+NW+0ttRMZWAaPnRmbDNdDgyoqcvCr1GKBlaIDWFOMWc+Nd5rhHxaGXr3gthlQdqa4obpk2xdOkBijMw="
    # AWS_ACCESS_KEY and AWS_SECRET_KEY for staging.vets.gov
    - secure: "1xqQr7sQdR2yKgcUpFJnRrP0JFaoOOmEIUiBEdYX43Gh4B5jOPrscQR9wOn/gmsUHatL0xVQf4HSarS+TQXpiX6AVfK2fohOijkdi6ozkbE1ZbTFaHUZyESvrIzbvK80Oirl5ez5VCe5cnToM2gDZ/t6UFaxmoizzVzzHK6CwmV7mC7075Ipn+UVHWJCJQRn67XobNP4bhV6M0LZl+PTBf63zU+OzEic/HZftHDEIwdmf8ponaxRvx507BoIEMukoH6pwPEmecOPPPophj6/unNUGh8CxrDUZlKlsNr6DEHZHMH5F+fapYuB7GTOyAL2CbVVEDiKdwtSuTb7N8A2qlsxXb54nDiKjkLaLClC78rQ5zHcTOH0K+JkbZtrGD6R+ruV9Mq6bmQqgsTPj3BXoommNw+jNreFe50qGmv2Ih9EKK6i5k0RRJMkYc+HLSMTtxmSE+h23/K1xyoqR66bB2ts2JAWPemJUzzaISSp/UGZS/qnsqfY2jkh0xiHvRY5qfwcocnz6mRPmdpD5GNG3CldwMcKvN8IhM40/BpotnerbpnuSLHF2A86boxsq5A76bVUhJIcqVjMdNNVR4088fy8dZkcKwLmxDVcmSqQZ5HnDEwQza79EdMy5nL42rudIWrlAqDXjWFoD5p0DxqX/CiZy4lIyypKQWDJu4akySY="
    # AWS_ACCESS_KEY and AWS_SECRET_KEY for www.vets.gov
    - secure: "GXmR/K/ggzv875l8+xQ968465F+kEU7OfpChGoFyMdkzlHLIqn3RamXg25ZDp81ph/y3G72Dzmwy7+pxehb2yg9Yh73ZLnRdPJvpNwInVU8V9nI7Qpm29NjMCV4aUmF80xNgK6ArYz141hn0ooPmUYCV5fMPpqJg1lHKDiX8USS7vcPw5OU4hrn6Ssexjowt1xjz2ZiWd/6IG4k1ov/YeYWUgXXr0kg6oXlrtlEJqCmZQGvNJaa2mCg1/MS5QhaYEFkgvJxsbCd9xtK61NlrSK1H+P1/fyg4oqwidEAClr7/YEQbdc83FXiewoWs7KAU8LeKr64N6rMEwH5cbwgIXPYZt4SXnCJGa4z7LaYrBHCjogGIy9VQoT0dR72yYofLr7tsjgVid0gBIhRjfdYpC0+JH4k8lr5SLEKuXrMLtrtx0C9E0dy+m4+GSpF6IhhJYIHHwBukDjCYuppIf2G2t/EdCqL7vD3SytgDmaOW8R8Cc6a7Q6djjtwTWPEvK3GnqA8l+vMQKsD7lVA4Kt0C+DSKvg3E6crJAVs/KQLjSeALlKi18eHOaRXyUTr+Y1vK5XQW4WxCC1wwm5eFuaYPeB3Kyw1r++ef0xQuMuow+Ao0D5YtDnJdNxYFL9qjVqF1Xvnw48FbZw/EazwhpUzUsmO1DQWVTth7qibZzU5pgfw="

notifications:
  email: false

before_install:
  - npm install -g npm@3.8.9
  - npm --version

cache:
  apt: true
  directories:
  - node_modules

script:
  - npm run lint
  - npm run build -- --buildtype development
  - npm run build -- --buildtype staging
  - npm run build -- --buildtype production
  - npm run selenium:bootstrap
  - npm run test

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8

before_deploy:
  - npm install -g s3-cli

deploy:
  - provider: script
    script: s3-cli sync --acl-public --delete-removed --recursive --region us-gov-west-1 build/development s3://dev.vets.gov/
    skip_cleanup: true
    on:
      repo: department-of-veterans-affairs/vets-website
      branch: burn-the-world
  - provider: script
    script: s3-cli sync --acl-public --delete-removed --recursive --region us-gov-west-1 build/staging s3://dev.vets.gov/
    skip_cleanup: true
    on:
      repo: department-of-veterans-affairs/vets-website
      branch: master
  - provider: s3
    access_key_id: AKIAKO2IAN6AOQEYC2HQ # awong govcloud key.
    secret_access_key:
      secure: vsDSvLeP0CWLEAbffadOH04hriQDw/GdvuKt5me77v7SjAAzZZNb8IPai6leOebgn/Sr/NvsKXUFrMzvLUAjwmH91VDEnq/YsPWzqqlDpONTVbBkiJQDKS+plVNLQZXQ89+6WVKcAOdFLmUH5EwxUpliEGrzdCcxY6v59DiETOykhsouLwDxirBGzgfBqZ46ARiFl2xRS8HYmlavcm8SP4CQFLlFTmFVYMji3waGRk4xaXv+E50iHI2J1Hjo48C7XW/x9oITTZiZnxNLql59lzczDyvdyYBdK/nNQReBatDxUElATQ7s2CfPGDHMaRcJ+6LxxJBXo3hlhD6cDC6ao9q8SqOc1DK5aSfUkt4G97eHeKUMro+BE5+ZkJ6xAszLT19Az6CefT+pEySbLl3RYeUBRvXn+6L5kPlEcSzCX5MXuOpEvQaxAxtsD083Q5Xv6dSa0e63WxlzfqirBDqaFvOtguYnNkS/g0kYGCQBfdkdLAuR45ylE8ElBod8izmdkqGQPu2JtHuisN3VolJQS+sx8KMbwaeHRZCDPpyLjJ9EHUnnEplH+mawKqDi3zkL3PprFH5Tj3f4cVLqR62IoqTbZA8ihOLDDSjuZs9G8Txe19Ehsks0VSzgdgR12CYpW8dGa99ULxUlmYUaBZfVrxmve19vLeYtY+Xwk0+gaPg=
    bucket: dev.vets.gov
    skip_cleanup: true
    region: us-east-1
    local-dir: build
    acl: public_read
    on:
      repo: department-of-veterans-affairs/vets-website
      branch: burn-the-worlda
  - provider: s3
    access_key_id: AKIAIEIFFI3LJZO44VTQ
    secret_access_key:
      secure: PKZPLle45zyvca1I3w8gxkwznCWM/EUqfw7W8WOGmHBDqvnZ24Cc26pOSKDE8p250rnDX42cxrnOuuGJUNpVTWoIdtKrfi3YEZi8yBXwMecKHsaZO3jQrWtGFVHV747gDmjx7THsacgAn5mvgZkuHXOZXpWcJaQtOLjLhqx++tuKSuSOkFENlRjm5fZWGUkWCBR4HjJPdfFazl8sE7TDomuOEumCjtqeKNFumlrPs+H34OyMpiMidU24Nsbla0exV7YkJTJ2PrdtkYFB3p6zZP26CHv12odkCsauZ3Ee1MUcmolNb3VgK6RPGiBvcozP7u/SdbXb5JYwBT/x/ffkowCcIZ+PNSzh/QF/TdJ0c2vtkfhTCiBDiOnBosFf3DAFCtXRCLEIlJtlxDbavBLTIEMnwkNKAQIRZP5ro4zMGjAJP/AWE0YvYZCQO8YXlb/Pl8QsH8HZY2+EYR8Qrjg/NcnnDfkg9rGdyslY/e9oMoJYYgmJlwpuIMlAWylhqUHfCzGFtUzTV+8GARjM7kkMwtIUqsjBbEYNu+kzd7O8xuJEbPepXkS6jE5F+PzyoVIoWgOCsAHKsFmyRqDjwQVOgMchp8thUMillCcDnNsbTawZ78/MfKWtZd9bHAglSxjWavV6Yr6tNumiI/vyRoQNbc1nIpxwjnMd0lN5bpykTwY=
    bucket: staging.vets.gov
    skip_cleanup: true
    upload-dir: shared
    region: us-east-1
    local-dir: build
    acl: public_read
    on:
      repo: department-of-veterans-affairs/vets-website
      branch: master
  - provider: s3
    access_key_id: AKIAJPGY3X77ZMIBM4OA
    secret_access_key:
      secure: m5rN6YkmhW8kCsd6lc7szFHmPy4iFuc8fXMLRUIGTQQCLok2xdbsx6J4CPEYbjoECTmvQ0HyBfrYDAgR9SypxBprjAs5vBUaccXxB9G9cTWinJrSRbAY2COXVXxWNfjqHZF0Jfk3UH/bzTx72BJL58vkb844RS/pEWBA/HiTmSpKTFaXwQzussMVuJdF4CROvymX0sHBurHap5Jdzytr2lV22cJ10/60rbc8S7XVACloIxsD/n/HJr79wf9J44gHbzjKEpvWpz3jsF/jTHkXkGuq/Li9qaD9mM9dCVYv7AlzXm8Wm4r8IP/qriIuOYsPouyiZHuky6y3oGDD6BaH6JAAUBwVX1e8FfxEjvDGQP4T6K0y3memwIE1NiI3JJbaqSAlNkgfHXwqE5WeP0XThK30X0B41Uu661YgGh9lTu9a2R9+XKPGjxoAi14RFNtMvS7Pwzv2jrUM7UD/7dfIQc0q3s1j/kaHkAlXi9CCvhAB9WRUXSuMJv+Zdcaua5XK0SSO8pBYT/NaY/3rI6G03I3vWG06KRZwsF0ilo2RKBtx+wH1K7tt33LBJdAx/AScoYMyY0hWCKZvtnKlvOc9Ucexy3JDC9aNOG3cvX4u5jPJLI5dpzZJE2dye5BucKkane999hmI37pgvgVE1/qdaN+NjyrGM/CX5kBs9JUfCe8=
    bucket: www.vets.gov
    skip_cleanup: true
    region: us-east-1
    local-dir: build
    acl: public_read
    on:
      repo: department-of-veterans-affairs/vets-website
      branch: production
